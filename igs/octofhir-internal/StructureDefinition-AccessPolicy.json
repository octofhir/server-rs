{
  "resourceType": "StructureDefinition",
  "id": "AccessPolicy",
  "url": "http://octofhir.io/StructureDefinition/AccessPolicy",
  "name": "AccessPolicy",
  "title": "Access Policy",
  "status": "active",
  "fhirVersion": "4.0.1",
  "kind": "logical",
  "abstract": false,
  "type": "AccessPolicy",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/DomainResource",
  "derivation": "specialization",
  "description": "An access policy that defines authorization rules. Policies can use different engines (allow, deny, quickjs) and be linked to clients, users, or roles via matchers.",
  "differential": {
    "element": [
      {
        "id": "AccessPolicy",
        "path": "AccessPolicy",
        "short": "Access control policy",
        "definition": "Defines authorization rules for resource access."
      },
      {
        "id": "AccessPolicy.name",
        "path": "AccessPolicy.name",
        "short": "Policy name",
        "definition": "Human-readable name for the policy",
        "min": 1,
        "max": "1",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.description",
        "path": "AccessPolicy.description",
        "short": "Policy description",
        "definition": "Detailed description of what this policy allows or denies",
        "min": 0,
        "max": "1",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.engine",
        "path": "AccessPolicy.engine",
        "short": "Policy engine",
        "definition": "The engine configuration for evaluating this policy",
        "min": 1,
        "max": "1",
        "type": [{ "code": "BackboneElement" }]
      },
      {
        "id": "AccessPolicy.engine.type",
        "path": "AccessPolicy.engine.type",
        "short": "Engine type",
        "definition": "The type of engine to use for evaluation",
        "comment": "Values: allow (always allow), deny (always deny), quickjs (JavaScript evaluation)",
        "min": 1,
        "max": "1",
        "type": [{ "code": "code" }]
      },
      {
        "id": "AccessPolicy.matcher",
        "path": "AccessPolicy.matcher",
        "short": "Matcher conditions",
        "definition": "Conditions that determine when this policy applies. All specified fields must match (AND logic).",
        "min": 0,
        "max": "1",
        "type": [{ "code": "BackboneElement" }]
      },
      {
        "id": "AccessPolicy.matcher.clients",
        "path": "AccessPolicy.matcher.clients",
        "short": "Client ID patterns",
        "definition": "Client ID patterns to match (supports wildcards with '*')",
        "min": 0,
        "max": "*",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.matcher.roles",
        "path": "AccessPolicy.matcher.roles",
        "short": "Required roles",
        "definition": "User roles to match (any role matches)",
        "min": 0,
        "max": "*",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.matcher.userTypes",
        "path": "AccessPolicy.matcher.userTypes",
        "short": "User FHIR types",
        "definition": "User FHIR resource types (e.g., 'Practitioner', 'Patient')",
        "min": 0,
        "max": "*",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.matcher.resourceTypes",
        "path": "AccessPolicy.matcher.resourceTypes",
        "short": "Target resource types",
        "definition": "FHIR resource types this policy applies to (empty means all)",
        "min": 0,
        "max": "*",
        "type": [{ "code": "code" }]
      },
      {
        "id": "AccessPolicy.matcher.operations",
        "path": "AccessPolicy.matcher.operations",
        "short": "FHIR operations",
        "definition": "FHIR operations to match (e.g., 'read', 'create', 'search', '*')",
        "min": 0,
        "max": "*",
        "type": [{ "code": "code" }]
      },
      {
        "id": "AccessPolicy.matcher.operationIds",
        "path": "AccessPolicy.matcher.operationIds",
        "short": "Operation IDs",
        "definition": "Specific operation IDs (e.g., 'fhir.read', 'graphql.query'). Supports wildcards.",
        "min": 0,
        "max": "*",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.matcher.paths",
        "path": "AccessPolicy.matcher.paths",
        "short": "Request paths",
        "definition": "Request path patterns (glob syntax)",
        "min": 0,
        "max": "*",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.matcher.sourceIps",
        "path": "AccessPolicy.matcher.sourceIps",
        "short": "Source IPs",
        "definition": "Source IP addresses in CIDR notation",
        "min": 0,
        "max": "*",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.engine.script",
        "path": "AccessPolicy.engine.script",
        "short": "JavaScript script",
        "definition": "JavaScript code for 'quickjs' engine. Has access to 'user', 'client', 'request', and 'resource' context objects.",
        "min": 0,
        "max": "1",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.denyMessage",
        "path": "AccessPolicy.denyMessage",
        "short": "Custom deny message",
        "definition": "Custom message returned when access is denied by this policy",
        "min": 0,
        "max": "1",
        "type": [{ "code": "string" }]
      },
      {
        "id": "AccessPolicy.priority",
        "path": "AccessPolicy.priority",
        "short": "Policy priority",
        "definition": "Evaluation priority (lower numbers evaluated first)",
        "min": 0,
        "max": "1",
        "type": [{ "code": "integer" }]
      },
      {
        "id": "AccessPolicy.active",
        "path": "AccessPolicy.active",
        "short": "Is policy active",
        "definition": "Whether this policy is currently active",
        "min": 1,
        "max": "1",
        "type": [{ "code": "boolean" }]
      }
    ]
  }
}
